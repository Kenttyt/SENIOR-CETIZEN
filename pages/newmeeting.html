<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <title>Senior Citizen</title>
  <link rel="stylesheet" href="../css/chatbot.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    :root {
      --primary-color: #0E4BF1;
      --panel-color: #FFF;
      --text-color: #000;
      --black-light-color: #000;
      --border-color: #e6e5e5;
      --toggle-color: #DDD;
      --box1-color: #4DA3FF;
      --box2-color: #FFE6AC;
      --box3-color: #E7D1FC;
      --title-icon-color: #fff;
      --tran-05: all 0.5s ease;
      --tran-03: all 0.3s ease;
    }

    body {
      min-height: 100vh;
      background-color: var(--primary-color);
    }

    body.dark {
      --primary-color: #3A3B3C;
      --panel-color: #242526;
      --text-color: #CCC;
      --black-light-color: #CCC;
      --border-color: #4D4C4C;
      --toggle-color: #FFF;
      --box1-color: #3A3B3C;
      --box2-color: #3A3B3C;
      --box3-color: #3A3B3C;
      --title-icon-color: #CCC;
    }

    .dashboard {
      position: relative;
      background-color: var(--panel-color);
      min-height: 100vh;
      padding: 10px 14px;
    }

   .top {
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: var(--panel-color, white);
  padding: 10px 14px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  width: 100%;
}

    .close-btn1 {
    
    
    text-align:center;
      
      margin-right:10px;
      padding: 10px 20px;
      background-color: #f44336;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
      
    }

    .close-btn1:hover {
      background-color: #d32f2f;
    }

    .search-box {
      margin-top:10px;
      position: relative;
      height: 45px;
      width: 100%;
      max-width: 100%;
    }

    .search-box input {
      width: 100%;
      height: 100%;
      padding: 0 25px 0 50px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      background-color: var(--panel-color);
      color: var(--text-color);
      font-size: 15px;
      outline: none;
    }

    .search-box i {
      position: absolute;
      top: 50%;
      left: 15px;
      transform: translateY(-50%);
      font-size: 22px;
      color: var(--black-light-color);
    }

    .overview .boxes {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }

    .box {
      flex: 1 1 250px;
      padding: 20px;
      border-radius: 12px;
      background: var(--box1-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: transform 0.3s;
    }

    .box:hover {
      transform: translateY(-5px);
    }

    .box .number {
      font-size: 40px;
      font-weight: 500;
      color: black ;
    }

    .box .text {
      font-size: 35px;
      color: black ;
    }

    .container {
      background: white;
      padding: 60px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      max-width: 400px;
      margin: 30px auto;
    }

    #reader {
      width: 300px;
      height: 300px;
      margin: auto;
    }

    #result {
      margin-top: 15px;
      font-size: 16px;
      color: green;
    }

    .done-button {
      background-color: #4caf50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }

    .done-button:hover {
      background-color: #45a049;
    }

    .year-box {
      background-color: white;
      padding: 30px 50px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      font-size: 2rem;
      font-weight: bold;
      color: #1a73e8;
      text-align: center;
      margin-top: -50px;
    }

    .activity-data-table {
      max-height: 700px;
      overflow-y: auto;
      margin-top: 20px;
      border: 1px solid #ccc;
    }

    .data-row {
      display: flex;
      border-bottom: 1px solid #eee;
    }

    .data-row.header {
      position: sticky;
      top: 0;
      background-color: white;
      font-weight: bold;
      border-bottom: 2px solid #aaa;
    }

    .cell {
      flex: 1;
      padding: 10px;
      display: flex;
      align-items: center;
    }
    .box .number {
  display: block;
  font-size: 32px;
  font-weight: bold;
  color: #333;
}
#scan-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

#scan-modal > div {
  background-color: #fff;
  padding: 40px 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
  text-align: center;
  position: relative;
}

#modal-time {
  font-size: 28px;
  font-weight: bold;
  color: #1a73e8;
  margin-bottom: 15px;
  position: absolute;
  top: -40px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 10px 20px;
  border-radius: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

#modal-content {
  font-size: 24px;
  color: #333;
  margin: 20px 0;
}

#scan-modal .done-button {
  margin: 10px 5px;
}
.dashboard .top .search-box{
    position: relative;
    height: 45px;
    max-width: 600px;
    width: 100%;
    margin: 0 30px;
}
.top .search-box input{
    position: absolute;
    border: 1px solid var(--border-color);
    background-color: var(--panel-color);
    padding: 0 25px 0 50px;
    border-radius: 5px;
    height: 100%;
    width: 100%;
    color: var(--text-color);
    font-size: 15px;
    font-weight: 400;
    outline: none;
}
.top .search-box i{
    position: absolute;
    left: 15px;
    font-size: 22px;
    z-index: 10;
    top: 50%;
    transform: translateY(-50%);
    color: var(--black-light-color);
}

  </style>


<body>
  <section class="dashboard">
  <div class="top">
    <button class="close-btn1" id="cancel-btn">Back</button>
    <div id="year-box" style="display:none">Senior Citizen Meeting</div>
  </div>
  
  
  
    
        

  
          
          

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      flex-direction: column;
      align-items: center;
    }
    .container1 {
      text-align: center;
      width: 100%;
      background: #fff;
      margin: 20px auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 10px;
      padding: 20px;
    }
    .date {
      font-size: 1.5em;
      margin-bottom: 5px;
    }
    .clock {
      font-size: 2em;
      margin-bottom: 10px;
      font-weight: bold;
    }
    #reader {
      width: 100%;
      margin: 50px auto;
      display: none;
    }
    
    #scanned-result {
      margin-top: 15px;
      font-size: 1.2em;
    }
    button {
      padding: 12px 20px;
      margin: 5px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background: #000;
      color: #fff;
    }
    button:hover {
      background: #000;
    }
    .hidden {
      display: none;
    }
    .table-container {
      width: 100%;
      background: #fff;
      padding: 20px;
      margin: 20px auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 10px;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    thead th {
      position: sticky;
      top: 0;
      background-color: #fff;
      color: #000;
      border: 1px solid #ddd;
      padding: 8px;
    }
    tbody td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 1em;
      background-color: #f5f5dc;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .summary {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 1.2em;
      text-align: left;
    }
    .summary p {
      flex: 1 1 45%;
      margin: 0;
    }
    .summary span {
      font-weight: bold;
    }
    #search-input {
      width: 100%;
      padding: 8px;
      font-size: 1em;
      margin: 15px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    @media (max-width: 480px) {
      .summary p {
        flex: 1 1 100%;
      }
      .clock {
        font-size: 1.5em;
      }
    }
    .modal {
      margin-top:50px;
      display: none;
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 30px;
      border-radius: 12px;
      max-width: 500px;
      text-align: center;
      font-size: 1.2em;
      position: relative;
    }
    #duplicate-warning {
      color: red;
      font-weight: bold;
      margin-top: 10px;
      display: none;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5em;
      cursor: pointer;
      color: #888;
    }
    .close-btn:hover {
      color: #000;
    }
    
    /* Add/modify these styles in your existing CSS */

    #reader {
      width: 100% !important; /* Override any inline styles */
      max-width: 500px !important; /* Maximum width for larger screens */
      margin: 0 auto !important;
      height: auto !important; /* Allow height to adjust proportionally */
      min-height: 300px; /* Minimum height to ensure visibility */
    }

    #reader video {
      width: 100% !important;
      height: auto !important;
      object-fit: cover !important;
    }

    .container1 {
      width: 95%; /* Slightly less than full width */
      max-width: 600px;
      margin: 20px auto;
      padding: 15px;
    }

    /* Media queries for different screen sizes */
    @media (max-width: 768px) {
      #reader {
        max-width: 100%;
        min-height: 250px;
      }
      
      .container1 {
        padding: 10px;
      }
      
      .modal-content {
        width: 90%;
        margin: 30% auto;
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      #reader {
        min-height: 200px;
      }
      
      .clock {
        font-size: 1.5em;
      }
      
      .date {
        font-size: 1.2em;
      }
    }

    /* Improve modal responsiveness */
    .modal-content {
      width: 90%;
      max-width: 400px;
      margin: 20% auto;
    }

    /* Action buttons container styles */
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .action-button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .stop-scan {
      background-color: #f44336;
      color: white;
    }

    .stop-scan:hover {
      background-color: #d32f2f;
    }

    .export-pdf {
      background-color: #034c73;
      color: white;
    }

    .export-pdf:hover {
      background-color: #034c73;
    }
    
    /* Enhanced modal styles */
    #modal-name {
      font-size: 2em;
      font-weight: bold;
      color: #1a73e8;
      margin: 10px 0 20px 0;
    }
    
    .contribution-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
    }
    
    .contribution-button {
      padding: 15px 25px;
      border: none;
      border-radius: 8px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .attendance-only {
      background-color: #64B5F6;
      color: white;
    }
    
    .attendance-only:hover {
      background-color: #42A5F5;
    }
    
    .with-contribution {
      background-color: #81C784;
      color: white;
    }
    
    .with-contribution:hover {
      background-color: #66BB6A;
    }
  </style>
    
  
  
  



  <!-- Scanner Section -->
  <div class="container1" id="scanner-container">
    <div class="date" id="date-display">Loading date...</div>
    <div class="clock" id="clock">00:00:00</div>
    <button id="start-button" onclick="startScanner()">Start Scanning</button>
    <button id="retry-button" class="hidden" onclick="startScanner()">Try Again</button>
    <div id="reader"></div>
    <button id="stop-button" class="hidden action-button stop-scan" onclick="stopScanner()">Done Scanning</button>
    <p id="scanned-result">Scan a QR code</p>
  </div>

  <!-- Table Section -->
  <div class="table-container">
    <div class="action-buttons">
      <button class="action-button export-pdf" onclick="exportToPDF()">
        <i class="uil uil-file-download-alt"></i> Export to PDF
      </button>
    </div>
    <input type="text" id="search-input" placeholder="Search name..." oninput="searchTable()">
    <table id="attendance-table">
      <thead>
        <tr>
          <th>Time</th>
          <th>Name</th>
          <th>Contribution</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="summary" id="summary">
      <p><span>Total Attendees:</span> 0 (<span id="attendance-percent">0%</span>)</p>
      <p><span>Total Contributions:</span> â‚±0</p>
    </div>
  </div>

  <!-- Modal -->
  <div id="contribution-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <p id="modal-name">Name: </p>
      <p id="duplicate-warning">Warning: This QR code has already been scanned.</p>
      <button onclick="handleAction('None')">Attendance Only</button>
      <button onclick="handleAction('â‚±10')">With â‚±10</button>
    </div>
  </div>
</div>

<script>
    // Load PDF.js library
    window.jsPDF = window.jspdf.jsPDF;

    const TOTAL_EXPECTED = 300;
    const scannedNames = new Set();
    let totalContributions = 0;
    let currentScannedValue = "";
    let scannerStarted = false;
    const html5QrCode = new Html5Qrcode("reader");

    // Check if we're using HTTPS
    function checkSecureContext() {
      if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        const warningMessage = "Camera access requires HTTPS! The QR scanner may not work properly.";
        document.getElementById("scanned-result").innerHTML = 
          `<span style="color:red;font-weight:bold">${warningMessage}</span>`;
        console.warn(warningMessage);
      }
    }

    // Call this function on page load
    window.addEventListener('DOMContentLoaded', checkSecureContext);

    function updateDateTime() {
      const now = new Date();
      const time = now.toLocaleTimeString();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const date = now.toLocaleDateString(undefined, options);
      document.getElementById("clock").textContent = time;
      document.getElementById("date-display").textContent = date;
    }

    setInterval(updateDateTime, 1000);
    updateDateTime();

    function startScanner() {
      if (scannerStarted) return;
      
      // Show loading state
      document.getElementById("scanned-result").textContent = "Initializing camera...";
      document.getElementById("reader").style.display = "block";
      document.getElementById("start-button").style.display = "none";
      document.getElementById("retry-button").classList.add("hidden");
      document.getElementById("stop-button").classList.remove("hidden");

      // Configure scanner
      const config = {
        fps: 10,
        qrbox: {
          width: Math.min(250, window.innerWidth - 50),
          height: Math.min(250, window.innerWidth - 50)
        },
        aspectRatio: 1.0,
        formatsToSupport: [ Html5QrcodeSupportedFormats.QR_CODE ],
        showTorchButtonIfSupported: true,
        rememberLastUsedCamera: true // Added to remember the last used camera
      };

      // Detect mobile devices
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      // Add more informative error handling
      function handleCameraError(err) {
        console.error("Camera error:", err);
        let errorMessage = "Failed to access camera.";
        
        if (err.name === "NotAllowedError") {
          errorMessage = "Camera access denied. Please allow camera permissions in your browser settings.";
        } else if (err.name === "NotFoundError") {
          errorMessage = "No camera found on this device.";
        } else if (err.name === "NotReadableError") {
          errorMessage = "Camera is in use by another application.";
        } else if (err.name === "OverconstrainedError") {
          errorMessage = "No suitable camera found.";
        } else if (err.name === "AbortError") {
          errorMessage = "Camera access aborted.";
        } else if (err.name === "SecurityError") {
          errorMessage = "Camera access blocked due to security restrictions. Please use HTTPS.";
        }
        
        document.getElementById("scanned-result").innerHTML = 
          `<span style="color:red">${errorMessage}</span>`;
        document.getElementById("retry-button").classList.remove("hidden");
        document.getElementById("start-button").style.display = "inline-block";
        document.getElementById("stop-button").classList.add("hidden");
        return false;
      }

      // First try to get list of cameras
      Html5Qrcode.getCameras().then(devices => {
        console.log("Available cameras:", devices);
        if (devices && devices.length) {
          // On mobile, prefer back camera
          let selectedCameraId;
          if (isMobile) {
            // Try to find back camera for mobile devices
            const backCamera = devices.find(device => 
              device.label.toLowerCase().includes('back') || 
              device.label.toLowerCase().includes('rear'));
            selectedCameraId = backCamera ? backCamera.id : devices[0].id;
          } else {
            // For desktop, just use the first camera
            selectedCameraId = devices[0].id;
          }
          
          // Start scanner with selected camera
          html5QrCode.start(
            { deviceId: { exact: selectedCameraId } },
            config,
            handleQRSuccess,
            handleQRError
          )
          .then(() => {
            scannerStarted = true;
            document.getElementById("scanned-result").textContent = "Scanner ready. Point at a QR code.";
          })
          .catch(err => {
            console.error("Error starting scanner with device ID:", err);
            // Fall back to environment facing mode
            fallbackToEnvironmentCamera();
          });
        } else {
          console.log("No cameras found, trying environment facing mode");
          fallbackToEnvironmentCamera();
        }
      }).catch(err => {
        console.error("Error getting cameras:", err);
        fallbackToEnvironmentCamera();
      });

      function fallbackToEnvironmentCamera() {
        html5QrCode.start(
          { facingMode: "environment" },
          config,
          handleQRSuccess,
          handleQRError
        )
        .then(() => {
          scannerStarted = true;
          document.getElementById("scanned-result").textContent = "Scanner ready. Point at a QR code.";
        })
        .catch(err => {
          console.log("Error starting scanner with environment mode, trying front camera:", err);
          // Last resort: try user facing camera
          html5QrCode.start(
            { facingMode: "user" },
            config,
            handleQRSuccess,
            handleQRError
          )
          .then(() => {
            scannerStarted = true;
            document.getElementById("scanned-result").textContent = "Scanner ready. Using front camera.";
          })
          .catch(finalErr => {
            handleCameraError(finalErr);
          });
        });
      }

      function handleQRSuccess(decodedText, decodedResult) {
        handleScan(decodedText.trim());
      }

      function handleQRError(errorMessage) {
        // Only log critical errors
        if (errorMessage.includes('NotAllowedError') || 
            errorMessage.includes('NotFoundError') || 
            errorMessage.includes('NotReadableError')) {
          console.error("QR Scanner error:", errorMessage);
        }
      }
    }

    function stopScanner() {
      if (scannerStarted) {
        html5QrCode.stop()
          .then(() => {
          scannerStarted = false;
          document.getElementById("reader").style.display = "none";
          document.getElementById("start-button").style.display = "inline-block";
          document.getElementById("stop-button").classList.add("hidden");
            document.getElementById("scanned-result").textContent = "Scanner stopped";
          })
          .catch(error => {
            console.error("Error stopping scanner:", error);
            // Force reset the scanner state
            scannerStarted = false;
            document.getElementById("reader").style.display = "none";
            document.getElementById("start-button").style.display = "inline-block";
            document.getElementById("stop-button").classList.add("hidden");
        });
      }
    }

    function handleScan(scannedText) {
      if (scannedText !== currentScannedValue) {
        currentScannedValue = scannedText;
        const isDuplicate = scannedNames.has(scannedText);
        document.getElementById("scanned-result").textContent = `Name: ${scannedText}`;
        document.getElementById("modal-name").textContent = `Name: ${scannedText}`;
        document.getElementById("duplicate-warning").style.display = isDuplicate ? "block" : "none";
        openModal();
      }
    }

    function handleAction(contribution) {
      const name = currentScannedValue;
      if (!name) return;

      if (scannedNames.has(name)) {
        const rows = document.querySelectorAll("#attendance-table tbody tr");
        for (let row of rows) {
          if (row.cells[1].textContent === name) {
            const previousContribution = row.cells[2].textContent;
            row.cells[2].textContent = contribution;
            if (previousContribution !== 'â‚±10' && contribution === 'â‚±10') {
              totalContributions += 10;
            } else if (previousContribution === 'â‚±10' && contribution !== 'â‚±10') {
              totalContributions -= 10;
            }
            updateSummary();
            break;
          }
        }
      } else {
        const time = new Date().toLocaleTimeString();
        const table = document.getElementById("attendance-table").getElementsByTagName("tbody")[0];
        const row = table.insertRow();
        row.insertCell(0).textContent = time;
        row.insertCell(1).textContent = name;
        row.insertCell(2).textContent = contribution;
        scannedNames.add(name);
        if (contribution === 'â‚±10') totalContributions += 10;
        updateSummary();
      }

      closeModal();
    }

    function updateSummary() {
      const attendees = scannedNames.size;
      const attendancePercent = ((attendees / TOTAL_EXPECTED) * 100).toFixed(1);

      document.querySelector("#summary p:nth-child(1)").innerHTML =
        `<span>Total Attendees:</span> ${attendees} (<span id="attendance-percent">${attendancePercent}%</span>)`;

      document.querySelector("#summary p:nth-child(2)").innerHTML =
        `<span>Total Contributions:</span> â‚±${totalContributions}`;
    }

    function searchTable() {
      const input = document.getElementById("search-input").value.toLowerCase();
      const rows = document.querySelectorAll("#attendance-table tbody tr");
      rows.forEach(row => {
        const name = row.cells[1].textContent.toLowerCase();
        row.style.display = name.includes(input) ? "" : "none";
      });
    }

    function openModal() {
      document.getElementById("contribution-modal").style.display = "block";
    }

    function closeModal() {
      currentScannedValue = "";
      document.getElementById("contribution-modal").style.display = "none";
      document.getElementById("scanned-result").textContent = "Scan a QR code";
    }

    function exportToPDF() {
      // Get attendance data
      const now = new Date();
      const dateStr = now.toLocaleDateString();
      const yearBoxElement = document.getElementById("year-box");
      const yearBoxContent = yearBoxElement ? yearBoxElement.innerHTML.replace("<br>", " ") : "Senior Citizen Meeting";
      
      // Create PDF document with A4 format
      const doc = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
      });
      
      // Add header with background
      doc.setFillColor(3, 76, 115); // #034c73
      doc.rect(0, 0, doc.internal.pageSize.width, 40, 'F');
      
      // Add title with white text
      doc.setTextColor(255, 255, 255);
      doc.setFont(undefined, 'bold');
      doc.setFontSize(24);
      doc.text('Attendance Report', doc.internal.pageSize.width / 2, 20, { align: 'center' });
      doc.setFontSize(16);
      doc.text(yearBoxContent.replace(/<[^>]*>/g, ''), doc.internal.pageSize.width / 2, 30, { align: 'center' });
      
      // Add summary box
      doc.setDrawColor(3, 76, 115);
      doc.setLineWidth(0.5);
      doc.roundedRect(15, 50, doc.internal.pageSize.width - 30, 40, 3, 3);
      
      // Add summary information
      doc.setTextColor(3, 76, 115);
      doc.setFontSize(14);
      const attendees = scannedNames.size;
      
      doc.text('Summary', 25, 65);
      doc.setFont(undefined, 'normal');
      doc.setFontSize(12);
      doc.text(`Total Expected: ${TOTAL_EXPECTED}`, 25, 75);
      doc.text(`Total Attendees: ${attendees}`, 25, 82);
      doc.text(`Total Contributions: â‚±${totalContributions}`, 25, 89);
      
      // Get table data
      const table = document.getElementById("attendance-table");
      const tableData = [];
      
      // Add data rows
      const tbody = table.tBodies[0];
      for (let i = 0; i < tbody.rows.length; i++) {
        const row = [];
        row.push(tbody.rows[i].cells[0].textContent); // Time
        row.push(tbody.rows[i].cells[1].textContent); // Name
        row.push(tbody.rows[i].cells[2].textContent.replace('â‚±', '')); // Contribution without â‚± symbol
        tableData.push(row);
      }
      
      // Generate table with improved styling
      doc.autoTable({
        head: [['Time', 'Name', 'Contribution']],
        body: tableData,
        startY: 100,
        styles: {
          fontSize: 10,
          cellPadding: 5,
          lineColor: [3, 76, 115],
          lineWidth: 0.1
        },
        headStyles: {
          fillColor: [3, 76, 115],
          textColor: [255, 255, 255],
          fontSize: 12,
          fontStyle: 'bold',
          halign: 'center'
        },
        bodyStyles: {
          textColor: [68, 68, 68]
        },
        alternateRowStyles: {
          fillColor: [240, 245, 250]
        },
        columnStyles: {
          0: { cellWidth: 'auto', halign: 'center' },
          1: { cellWidth: 'auto' },
          2: { cellWidth: 'auto', halign: 'center' }
        },
        margin: { top: 100, left: 15, right: 15 }
      });
      
      // Add footer with page numbers and timestamp
      const pageCount = doc.internal.getNumberOfPages();
      const timestamp = now.toLocaleString();
      
      for(let i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFontSize(8);
          doc.setTextColor(128, 128, 128);
          
          // Add timestamp on the left
          doc.text(`Generated: ${timestamp}`, 15, doc.internal.pageSize.height - 10);
          
          // Add page numbers on the right
          doc.text(
              `Page ${i} of ${pageCount}`,
              doc.internal.pageSize.width - 15,
              doc.internal.pageSize.height - 10,
              { align: 'right' }
          );
      }
      
      // Save the PDF
      doc.save(`Attendance_Report_${dateStr.replace(/\//g, '-')}.pdf`);
    }

    window.onclick = function(event) {
      const modal = document.getElementById("contribution-modal");
      if (event.target == modal) {
        closeModal();
      }
    }
  </script>
  
  <script>
      
  document.getElementById("cancel-btn").addEventListener("click", () => {
  window.history.back();
});


   
</script>


       <div class="chat-icon" id="chatIcon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: white;">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </div>


    
<!-- Chat Widget -->
<div class="chat-widget" id="chat-widget">
    <div class="chat-bubble" id="chat-bubble">
        <i>ðŸ’¬</i>
    </div>
    
    <div class="chat-container" id="chat-container">
        <div class="chat-header">
            <div class="chat-title">
                <span class="status-indicator"></span>
                AI Assistant
            </div>
            <div class="chat-close" id="chat-close">Ã—</div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="message-container bot-container">
                <div class="message bot-message">
                    Maayong adlaw! Ako imong AI assistant. Unsay akong ikatabang nimo karon?
                </div>
                <span class="timestamp">Now</span>
            </div>
            
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-bubble"></div>
                <div class="typing-bubble"></div>
                <div class="typing-bubble"></div>
            </div>
        </div>
        
        <div class="chat-input">
            <textarea class="chat-input-field" id="chat-input-field" placeholder="I-type imong mensahe..." rows="1"></textarea>
            <button class="chat-send-btn" id="chat-send-btn">âž¤</button>
        </div>
    </div>
</div>

 
 
 <script src="../js/chatbot.js"></script>


</body>

</html>
